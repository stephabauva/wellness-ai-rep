
{
  "tableOfContents": {
    "attachments": {
      "features": ["file-attachment", "attachment-preview", "audio-recording"],
      "components": ["AttachmentPreview", "AudioRecorder", "ChatInputArea"],
      "endpoints": ["POST /api/chat/attachments", "GET /api/chat/attachments/:id", "POST /api/chat/transcribe"]
    }
  },
  "integrationStatus": {
    "file-attachment": {
      "status": "active",
      "lastVerified": "2025-01-27",
      "knownIssues": []
    },
    "attachment-preview": {
      "status": "active",
      "lastVerified": "2025-01-27",
      "knownIssues": []
    },
    "audio-recording": {
      "status": "active",
      "lastVerified": "2025-01-27",
      "knownIssues": []
    }
  },
  "lastUpdated": "2025-01-27T10:00:00Z",
  "dependencies": ["file-manager", "core-messaging"],
  "featureGroups": {
    "attachments": {
      "description": "File attachment capabilities including upload, preview, and audio recording",
      "features": {
        "file-attachment": {
          "description": "Upload and attach files to chat messages",
          "userFlow": [
            "User clicks paperclip icon in chat input",
            "User selects files from device or camera",
            "Files upload with progress indication",
            "Attached files appear in message before sending"
          ],
          "systemFlow": [
            "Handle file selection and validation",
            "Upload files to server with progress tracking",
            "Store file metadata and associate with message",
            "Include file references in chat message"
          ],
          "components": ["ChatInputArea", "AttachmentPreview"],
          "apiIntegration": {
            "expectedEndpoints": ["POST /api/chat/attachments"],
            "actualEndpoints": ["POST /api/chat/attachments"],
            "integrationGaps": [],
            "cacheDependencies": {
              "invalidates": ["query:attachments", "query:messages", "query:fileUploads"],
              "refreshesComponents": ["AttachmentPreview", "MessageDisplayArea", "ChatInputArea"]
            },
            "uiConsistencyValidation": {
              "tested": true,
              "knownIssues": []
            }
          },
          "logging": {
            "$ref": "../infrastructure/logging.map.json#/attachment-logging"
          },
          "performance": {
            "$ref": "../infrastructure/performance.map.json#/attachment-performance"
          },
          "tests": ["client/src/components/AttachmentPreview.test.tsx"]
        },
        "attachment-preview": {
          "description": "Preview and display attached files in chat messages",
          "userFlow": [
            "User sees attachment previews in messages",
            "User can click to view full attachment",
            "Supports images, documents, and other file types"
          ],
          "systemFlow": [
            "Fetch attachment metadata from database",
            "Generate appropriate preview based on file type",
            "Handle full-size viewing and download"
          ],
          "components": ["AttachmentPreview"],
          "apiIntegration": {
            "expectedEndpoints": ["GET /api/chat/attachments/:id"],
            "actualEndpoints": ["GET /api/chat/attachments/:id"],
            "integrationGaps": [],
            "cacheDependencies": {
              "invalidates": ["query:attachments"],
              "refreshesComponents": ["AttachmentPreview"]
            },
            "uiConsistencyValidation": {
              "tested": true,
              "knownIssues": []
            }
          },
          "logging": {
            "$ref": "../infrastructure/logging.map.json#/attachment-preview-logging"
          },
          "performance": {
            "$ref": "../infrastructure/performance.map.json#/attachment-preview-performance"
          },
          "tests": ["client/src/tests/chat/AttachmentDisplay.test.tsx"]
        },
        "audio-recording": {
          "description": "Record and attach audio messages to chat",
          "userFlow": [
            "User clicks microphone icon",
            "User records audio message",
            "Audio is transcribed and attached to message"
          ],
          "systemFlow": [
            "Capture audio from user device",
            "Send audio to transcription service",
            "Attach both audio file and transcription"
          ],
          "components": ["AudioRecorder"],
          "apiIntegration": {
            "expectedEndpoints": ["POST /api/chat/transcribe"],
            "actualEndpoints": ["POST /api/chat/transcribe"],
            "integrationGaps": [],
            "cacheDependencies": {
              "invalidates": ["query:attachments", "query:transcriptions"],
              "refreshesComponents": ["AudioRecorder", "AttachmentPreview"]
            },
            "uiConsistencyValidation": {
              "tested": true,
              "knownIssues": []
            }
          },
          "logging": {
            "$ref": "../infrastructure/logging.map.json#/audio-recording-logging"
          },
          "performance": {
            "$ref": "../infrastructure/performance.map.json#/audio-recording-performance"
          },
          "tests": []
        }
      }
    }
  },
  "components": {
    "AttachmentPreview": {
      "name": "AttachmentPreview",
      "path": "client/src/components/AttachmentPreview.tsx",
      "description": "Displays file attachments with appropriate previews and actions",
      "uses": ["useFileApi"]
    },
    "AudioRecorder": {
      "name": "AudioRecorder",
      "path": "client/src/components/AudioRecorder.tsx", 
      "description": "Audio recording interface with transcription capabilities",
      "uses": ["audio-service"]
    },
    "ChatInputArea": {
      "name": "ChatInputArea",
      "path": "client/src/components/ChatInputArea.tsx",
      "description": "Text input area with attachment support",
      "uses": ["useFileUpload", "AttachmentPreview", "AudioRecorder"]
    }
  },
  "apiEndpoints": {
    "/api/chat/attachments": {
      "method": "POST",
      "handler": "server/routes/chat-routes.ts",
      "description": "Upload file attachments for chat messages",
      "readsFrom": [],
      "modifies": ["message_attachments", "files"]
    },
    "/api/chat/attachments/:id": {
      "method": "GET", 
      "handler": "server/routes/chat-routes.ts",
      "description": "Retrieve specific attachment file",
      "readsFrom": ["message_attachments", "files"],
      "modifies": []
    },
    "/api/chat/transcribe": {
      "method": "POST",
      "handler": "server/routes/chat-routes.ts",
      "description": "Transcribe audio files to text",
      "readsFrom": [],
      "modifies": ["message_attachments", "transcriptions"]
    }
  },
  "database": {
    "tables": {
      "message_attachments": {
        "description": "File attachments associated with chat messages",
        "columns": ["id", "message_id", "file_path", "file_name", "file_size", "mime_type", "created_at"],
        "relations": ["conversation_messages"],
        "indexes": ["message_id", "created_at"]
      },
      "files": {
        "description": "File storage metadata",
        "columns": ["id", "path", "name", "size", "mime_type", "created_at"],
        "relations": ["message_attachments"],
        "indexes": ["path", "created_at"]
      },
      "transcriptions": {
        "description": "Audio transcription data",
        "columns": ["id", "attachment_id", "text_content", "confidence_score", "created_at"],
        "relations": ["message_attachments"],
        "indexes": ["attachment_id"]
      }
    }
  }
}
